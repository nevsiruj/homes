# Netlify configuration for Nuxt 3 (Static Generation)
[build]
  base = "homes-web"
  publish = "dist"
  command = "npm run generate"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

[functions]
  directory = "netlify/functions"

# --- HEADERS ---
# Usamos minúsculas "cache-control" para evitar conflictos con Nitro/Nuxt
[[headers]]
  for = "/_nuxt/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/inmueble/*"
  [headers.values]
    cache-control = "public, max-age=3600, must-revalidate"
    X-Robots-Tag = "index, follow"

# --- REDIRECTS ---
# 1. Proxies de Luxury Homes (Prioridad alta)
[[redirects]]
  from = "/luxury-homes/*"
  to = "https://old-web.homesguatemala.com/luxury-homes/:splat"
  status = 200

# 2. Funciones API
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# 3. SPA Fallback (Esencial para que Facebook/WhatsApp no reciban 404)
# Nota: Netlify servirá primero cualquier archivo .html que exista en /dist
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200